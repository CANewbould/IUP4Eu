<!DOCTYPE html 
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
 <title></title>
 <link rel="stylesheet" media="screen, projection, print" type="text/css" href="style.css"/>
<!-- source="tutorial.cr" -->
</head>
<body>

<a name="_0_aniuptutorial"></a><a name="aniuptutorial"></a><h1>An IUP Tutorial</h1>
<p> Original authors: Gustavo H. S. de O. Lyrio &amp; Antonio E. Scuri</p>

<p> Open Euphoria version: adapted by Charles A. Newbould</p>

<p> 
<p><br />
Index<br />
1. Introduction<br />
2. Hello World<br />
2.1 Initialization<br />
2.2 Creating a Dialog<br />
2.3 Adding Interaction<br />
2.4 Adding Layout Elements<br />
2.5 Improving the Layout<br />
3. Simple Notepad<br />
3.1 Main Dialog<br />
3.2 Adding a Menu<br />
3.3 Using Pre-defined Dialogs<br />
3.4 Custom Dialogs<br />
3.5 Adding a Toolbar and a Statusbar<br />
3.6 Defining Hot Keys<br />
3.7 Recent Files Menu and a Configuration File<br />
3.8 Clipboard Support<br />
3.9 More File Management (Drag&amp;Drop, Command Line, ...)<br />
3.10 Dynamic Layout<br />
3.11 External Help<br />
3.12 Final Considerations<br />
4. Simple Paint<br />
4.1  Loading and Saving Images<br />
4.2 Drawing with OpenGL<br />
4.3 Drawing with CD and Printing<br />
4.4 Interactive Zoom and Scrollbars<br />
4.5 Canvas Interaction and a ToolBox<br />
4.6 Image Processing and Final Considerations<br />
</p>

<p> 
<p><br />
5. Advanced Topics<br />
5.1 C<ins>  Encapsulation <br />
5.2 C</ins>  Modularization <br />
5.3 High Resolution Display <br />
5.4 Splash Screen, About and System Information<br />
5.5 Dynamic Libraries<br />
6. Simple Calc - Under Construction<br />
6.1 Data Matrix<br />
6.2 Plotting Data<br />
6.3 Numbers, Units and Formulas<br />
6.4 Embedded Help<br />
7. Simple Draw - Under Construction<br />
7.1 Hierarchy Tree for Objects<br />
7.2 Embedded Controls in Canvas<br />
7.3 Script Editor for Lua<br />
7.4 Background Processing using Multithread<br />
7.5 UTF-8 Character Encoding<br />
7.6 Multilanguage Interface<br />
</p>

<a name="_1_1introduction"></a><a name="1introduction"></a><h2>1. Introduction</h2>
<p> Hello and welcome to the IUP Tutorial. Our goal is to provide a walkthrough guide to develop IUP applications focused in people that haven't used IUP before. First of all it is necessary to describe what IUP is and how it can help you develop your application. IUP stands for "Interface User Portable". It is a multi-platform toolkit for building graphical user interfaces, offering a simple API, and its purpose is to allow the user interface source code of an application to be compiled in different systems without any modification. Supported systems include: GTK+ and Windows. As main advantages, IUP offers: high performance since it uses native interface elements, and a fast learning curve due to the simplicity of its API. Also, IUP uses an abstract layout model based on the boxes-and-glue paradigm from the TeX text editor making the dialog creation task more flexible and independent from the graphics system resolution.  </p>

<p> IUP has three concepts that any user has to understand: Elements, Attributes and Callbacks.  </p>

<a name="_2_elements"></a><a name="elements"></a><h3>Elements</h3>
<p> <strong>Elements</strong> are "every kind of interface element present in the application." IUP contains several user interface elements. The library's main characteristic is the use of native elements. This means that the drawing and management of a button or text box is done by the native interface system, not by IUP. This makes the application's appearance more similar to other applications in that system. On the other hand, the application's appearance can vary from one system to another. Besides, some additional controls are drawn by IUP,  and are independent from the native system. Dialogs are special  elements that represent every window created by IUP. Any application that uses IUP will be composed by one or more dialogs. Every dialog can contains one  or more controls inside.  </p>

<a name="_3_attributes"></a><a name="attributes"></a><h3>Attributes</h3>
<p> <strong>Attributes</strong> are "used to change or consult properties of  elements." Each element has a set of attributes that affects its behavior or its appearance.  Each attribute may work differently for each elements, but usually attributes with  the same name work the same. Attribute names are always upper case. But attribute values like "YES", "NO", "TOP", are case insensitive, so "Yes", "no", "top", and other variations will work.  </p>

<a name="_4_callbacks"></a><a name="callbacks"></a><h3>Callbacks</h3>
<p> <strong>Callbacks</strong> are "functions which notify the application that  some user interface event occurred." Usually callbacks will be called only when  the user interacts with the application elements. If the application register  the callback function, then the function will be called every time the event  occurs.</p>

<p> All we have seen until now is a short summary of what is behind the IUP toolkit and concepts that the developer needs to be familiarized with when programming with IUP. From now on, we are going to present how to build an IUP application from the most simple example possible to a complex and full of different resources application.</p>

<p> All examples are stored in the <em>examples</em> folder and have the <em>exw</em> extension, to signify that they are GUI applications. Note that the illustrative examples may not look exactly like those in the body of this text, depending on which operating system and, possibly, which version of IUP you are using.</p>

<a name="_5_2helloworld"></a><a name="2helloworld"></a><h2>2. Hello World</h2>
<a name="_6_21initialization"></a><a name="21initialization"></a><h3>2.1 Initialization</h3>
<p> The code bellow will shows how to open an IUP environment and displays a simple message. Each line of code is explained after the code.</p>

<p> For this first example the original C-language code is copied, inside an Open Euphoria comment block, before the Open Euphoria code equivalent is listed. Note how similar they are, especially when the Euphoria code is set in the form of a <tt>main</tt> routine.</p>

<p> Note also the numeric markers (1 to 7) as comment after the code lines; these link to the explanation which follows.</p>

<pre class="examplecode"><font color="#FF0055">-- example2_1.exw</font>

<font color="#FF0055">-- LyrioScuri Tutorial</font>

<font color="#FF0055">/* 
</font>
<font color="#330033">#include &lt;stdlib.h&gt;</font>
<font color="#330033">#include &lt;iup.h&gt;</font>

<font color="#330033">int main</font><font color="#880033">(</font><font color="#330033">int argc, char **argv</font><font color="#880033">)</font>
<font color="#880033">{</font>
<font color="#330033">  IupOpen</font><font color="#993333">(</font><font color="#330033">&amp;argc, &amp;argv</font><font color="#993333">)</font><font color="#330033">;</font>
  
<font color="#330033">  IupMessage</font><font color="#993333">(</font><font color="#330033">"Hello World 1"</font><font color="#330033">, </font><font color="#330033">"Hello world from IUP."</font><font color="#993333">)</font><font color="#330033">;</font>
  
<font color="#330033">  IupClose</font><font color="#993333">()</font><font color="#330033">;</font>
<font color="#0000FF">  return </font><font color="#330033">EXIT_SUCCESS;</font>
<font color="#880033">}</font>
<font color="#330033">*/</font>

<font color="#0000FF">include </font><font color="#330033">iup.ew                                      </font><font color="#FF0055">-- 1</font>

<font color="#0000FF">function </font><font color="#330033">main</font><font color="#880033">()</font>
<font color="#330033">    IupOpen</font><font color="#880033">()                                       </font><font color="#FF0055">-- 2</font>
<font color="#330033">    IupMessage</font><font color="#880033">(</font><font color="#330033">"Hello World 1"</font><font color="#330033">, </font><font color="#330033">"Hello from IUP"</font><font color="#880033">)   </font><font color="#FF0055">-- 3</font>
<font color="#FF0055">    --IupMainLoop()                                 -- 4</font>
<font color="#330033">    IupClose</font><font color="#880033">()                                      </font><font color="#FF0055">-- 5</font>
<font color="#0000FF">    return </font><font color="#330033">EXIT_SUCCESS                             </font><font color="#FF0055">-- 6</font>
<font color="#0000FF">end function</font>

<font color="#FF0055">-- execution</font>
<font color="#330033">main</font><font color="#880033">()                                              </font><font color="#FF0055">-- 7</font>
</pre>

<p> <img src="images/HelloWorld_1.png" alt="images/HelloWorld_1.png" caption="images/HelloWorld_1.png" /></p>

<p> The following text links the lines:</p>
<ol><li>The main IUP library is made available. This is all we need for our first example. (If Euphoria cannot find the relevant module then the program will exit with a message. Also, you may need to add a configuration file to the <em>examples</em> folder to ensure Euphoria can find the <em>iup.ew</em> module; an <em>eu.cfg</em> is provided in the <em>examples</em> folder.)
</li><li>Before running any of the IUP's functions, the function <tt>IupOpen</tt> must be called to initialize the toolkit. (Note that in IUP4Eu this routine doesn't take any arguments.)
</li><li>The next line creates and displays a message to the user using the <tt>IupMessage</tt> function. This function receives two arguments: <em>title</em> and <em>message</em>. The title is displayed at the top of the message window and the message is a text message displayed to the user. (Note that, depending on the IUP/OS combination, you may see an information icon in addition to the text message.)
</li><li>In this simple example there is no need to call <tt>IupMainLoop</tt> because <tt>IupMessage</tt> is self contained. Most programs need to call <tt>IupMainLoop</tt>. (In fact to include it in this example will stop the programming exiting this loop. To see how to avoid this, look at the next example.)
</li><li>Following, we have a <tt>IupClose</tt> function call. After running the last IUP function, <tt>IupClose</tt> must be run so that the toolkit can free internal memory and close the interface system.
</li><li>To simulate the C-language example, the Euphoria code is cast as a function, returning a value that signifies a successful exit.
</li><li>Again to parallel the C-language code we execute the <tt>main</tt> function. Note that Euphoria doesn't have a built-in <tt>main</tt>; note also that there is no need to trap or test the return value. (We could equally have cast <tt>main</tt> as a procedure but a function has been defined to retain the similarity with C.)
</li></ol>
<p>If you study the Lua version of this example you will find a call to  <tt>iup.MainLoopLevel</tt>.  It will check if <tt>iup.MainLoop</tt> was already called to avoid calling it again. This is useful only if your script  could be executed from inside another context, for regular applications there is no need for calling it.</p>

<p> The next example shows how you could address this.</p>

<pre class="examplecode"><font color="#FF0055">--example2_1a.exw</font>

<font color="#0000FF">include </font><font color="#330033">iup.ew                                        </font><font color="#FF0055">-- 1</font>

<font color="#0000FF">function </font><font color="#330033">main</font><font color="#880033">()                                       </font><font color="#FF0055">-- 2</font>
<font color="#330033">    IupOpen</font><font color="#880033">()                                         </font><font color="#FF0055">-- 3</font>
<font color="#330033">    IupMessage</font><font color="#880033">(</font><font color="#330033">"Hello World 1a"</font><font color="#330033">, </font><font color="#330033">"Hello from IUP"</font><font color="#880033">)    </font><font color="#FF0055">-- 4  </font>
<font color="#0000FF">    if </font><font color="#330033">IupMainLoopLevel</font><font color="#880033">() </font><font color="#330033">= 0 </font><font color="#0000FF">then                    </font><font color="#FF0055">-- 5</font>
<font color="#330033">        IupExitLoop</font><font color="#880033">()                                 </font><font color="#FF0055">-- 6</font>
<font color="#0000FF">    end if</font>
<font color="#330033">    IupClose</font><font color="#880033">()                                        </font><font color="#FF0055">-- 7</font>
<font color="#0000FF">    return </font><font color="#330033">EXIT_SUCCESS                               </font><font color="#FF0055">-- 8</font>
<font color="#0000FF">end function</font>

<font color="#FF0055">-- execution</font>
<font color="#330033">main</font><font color="#880033">()                                                </font><font color="#FF0055">-- 9</font>
</pre>

<p> As above the numeric comments are used to identify the processes.</p>
<ol><li>The main IUP library is made available.
</li><li>We continue to cast the example inside a <tt>main</tt> function.
</li><li>The function <tt>IupOpen</tt> initializes the toolkit.
</li><li>The next line creates and displays a message to the user using the <tt>IupMessage</tt> function. (The message is slightly different from in the last example, to indicate a different calling application.)
</li><li>We test for use of <tt>IupMainLoop</tt> by using <tt>IupMainLoopLevel</tt> to establish if the event loop is active.
</li><li>TWe use <tt>IupExitLoop</tt> to force a successful exit.
</li><li><tt>IupClose</tt> closes the toolkit.
</li><li>We return a suitable value for the function's operation.
</li><li>We execute <tt>main</tt>.
</li></ol>
<p>Note that this second example is not illustrating the conventional approach to IUP programming, which uses <tt>IupMainLoop</tt> explicitly, but rather to show that there can be multiple ways to achieve a given effect.</p>

<p> Normally we just call <tt>IupMainLoop</tt>, which listens for events and matches the event owner with a suitable function. You call <tt>IupMainLoop</tt> just once; <tt>IupMainLoopLevel</tt> is used to tell you if the main loop is already active. </p>

<a name="_7_iupapplications"></a><a name="iupapplications"></a><h2>IUP Applications</h2>
<a name="_8_22creatingadialog"></a><a name="22creatingadialog"></a><h3>2.2 Creating a Dialog</h3>
<p> Let's change the previos example a little bit to add our own dialog.</p>

<p> Dialogs are the core of IUP design and provide the structure for the "top-level-window", as it is known in other GUIs.</p>

<p> A distinguishing feature of IUP is the "bottom-up" approach to design: elements in a GUI are declared from the "inside" outwards, culminating in the declaration of the dialog as the main window.</p>

<p> IUP also provides compositional tools. These enable grouping of associated elements and, most importantly, manage the sizes and relative arrangements within such groups.</p>

<p> The main reason for IUP simplicity of use, however, comes from its universal use, for all types of elements, of attributes, where specific properties are assigned specific values.</p>

<pre class="examplecode"><font color="#FF0055">-- example2_2.exw</font>

<font color="#0000FF">include </font><font color="#330033">iup.ew</font>

<font color="#330033">IupOpen</font><font color="#880033">()</font>

<font color="#0000FF">atom </font><font color="#330033">lbl = IupLabel</font><font color="#880033">(</font><font color="#330033">"Hello world from IUP"</font><font color="#880033">)</font>
<font color="#0000FF">atom </font><font color="#330033">dlg = IupDialog</font><font color="#880033">(</font><font color="#330033">IupVbox</font><font color="#993333">(</font><font color="#0000FF">{</font><font color="#330033">lbl</font><font color="#0000FF">}</font><font color="#993333">)</font><font color="#880033">)</font>
<font color="#330033">IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"TITLE"</font><font color="#330033">, </font><font color="#330033">"Hello World 2"</font><font color="#880033">)</font>
            
<font color="#330033">IupShowXY</font><font color="#880033">(</font><font color="#330033">dlg, IUP_CENTER, IUP_CENTER</font><font color="#880033">)</font>
<font color="#330033">IupMainLoop</font><font color="#880033">()</font>
<font color="#330033">IupClose</font><font color="#880033">()</font>
</pre>

<p> After opening the IUP session, we declared two new (<strong>atom</strong>) variables to hold IUP elements; one called <em>dlg</em> for our main dialog and another called <em>lbl</em>, to hold a label containing our hello message. Both variables, in typical Open Euphoria-style, are initialised on declaration. The label control takes the text string as its only argument. The main dialog is created using the <tt>IupDialog</tt> function. Its parameter is always a single element, which is nearly always a compositional one. Here, because we never need to refer to it again, we make it the result of creating a composition element using <tt>IupVbox</tt>. A <em>Vbox</em> in IUP is a control that orders all controls passed to it in a vertical direction. In this example, we are only passing one control (our label), but <tt>IupVbox</tt> is programmed to take a list of elements, hence the use of a one-element sequence here. In the next line we show one way in which IUP changes each control attribute (ie. property). By calling the function <tt>IupSetAttribute</tt> the programmer is able to specify what value a named attribute should carry in the specific context. In our sample, we are setting the main dialog's caption to "Hello World 2". This concludes the compositional section of our application. (Another compositional element is provided by <tt>IupHbox</tt>, which arranges its member elements horizontally rather than vertically. Before moving on, think for a minute what, if any, the use of this function would make!)</p>

<p> We now move on to the "action" section! The next function, called <tt>IupShowXY</tt>, tells IUP how and where to display the main dialog. In this example it is to be displayed at the centre of the screen, both horizontally and vertically, as the repeated values indicate.</p>

<p> Next comes that most important function, <tt>IupMainLoop</tt>, which we have introduced above. This function tells IUP to wait for events. Without it the program would simply go on, thereby ending the IUP session and terminating the Euphoria program, without dealing with any event. Why not try this out? Comment out this line, run your code and you will see the main dialog blink on the screen; the program ends just after it so you could easily miss the effect! It will prove to be a valuable exercise.</p>

<p> Note: <em>label</em> is a keyword in Euphoria, so you cannot use it as an identifier for a variable - hence the use of the alternative <em>lbl</em> here.</p>

<p> Note also, that for the purposes of generating the Open Euphoria wrapper, <em>iup.ew</em>, all the IUP C-language functions have been mapped into Euphoria <em>function</em>s, but that in several cases, and most in this example, these have been called in "VOID mode", that is, without attempting to trap the return value.</p>

<p> All IUP applications, from the most simple "hello world" to the most complex, follow this same code structure, so it well worth studying it and getting familiar with its form. It is also worth thinking about what sort of "template" most appeals to you. This example has a simple-flow layout, whereas earlier examples adopted a <tt>main</tt> routine approach (note that it could perfectly reasonably have been cast as a <em>procedure</em>). There is also a case to be made for adopting some form of indentation to show the IUP session more clearly [from after the call to <tt>IupOpen</tt>() to before the call to <tt>IupClose</tt>()], especially in the early stages of learning, to emphasise the nature of the process.</p>

<p> In the rest of this presentation I shall adopt the <tt>main</tt> <em>procedure</em> approach, because it has certain advantages for generalising your applications by allowing the passing of values through <tt>main</tt> at run time.</p>

<a name="_9_23addinginteraction"></a><a name="23addinginteraction"></a><h3>2.3 Adding Interaction</h3>
<p> In the previous section, we saw how to build a basic IUP application, but without any custom interaction with the dialog. In this section, we add interaction to our application using a button.  </p>

<p> Interaction is effected through <em>callbacks</em>. These are special functions defined by the programmer and  called by IUP when an event needs to be handled. To create a callback, the programmer must declare a function and put inside its body anything that he/she wants the application to do when the event occurs. After that, it is necessary to inform IUP that the function is, in fact, a callback. That is done calling the function <tt>IupSetCallback</tt>. This ensures that the function will be executed when a specific event ("action") occurs.</p>

<pre class="examplecode"><font color="#FF0055">-- example2_3.exw</font>

<font color="#0000FF">include </font><font color="#330033">iup.ew</font>

<font color="#0000FF">function </font><font color="#330033">btn_exit_cb</font><font color="#880033">( )</font>
<font color="#330033">    IupMessage</font><font color="#880033">(</font><font color="#330033">"Hello World Message"</font><font color="#330033">, </font><font color="#330033">"Hello from IUP"</font><font color="#880033">)</font>
<font color="#0000FF">    return </font><font color="#330033">IUP_CLOSE</font>
<font color="#0000FF">end function</font>

<font color="#330033">IupOpen</font><font color="#880033">()</font>

<font color="#0000FF">atom </font><font color="#330033">button = IupButton</font><font color="#880033">(</font><font color="#330033">"OK"</font><font color="#880033">)</font>
<font color="#0000FF">atom </font><font color="#330033">vbox = IupVbox</font><font color="#880033">(</font><font color="#993333">{</font><font color="#330033">button</font><font color="#993333">}</font><font color="#880033">)</font>
<font color="#0000FF">atom </font><font color="#330033">dlg = IupDialog</font><font color="#880033">(</font><font color="#330033">vbox</font><font color="#880033">)</font>
<font color="#330033">            IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"TITLE"</font><font color="#330033">, </font><font color="#330033">"Hello World 3"</font><font color="#880033">)</font>
<font color="#330033">            IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"SIZE"</font><font color="#330033">, </font><font color="#330033">"QUARTERxEIGHTH"</font><font color="#880033">)</font>
            
<font color="#330033">IupSetCallback</font><font color="#880033">(</font><font color="#330033">button, </font><font color="#330033">"ACTION"</font><font color="#330033">, Icallback</font><font color="#993333">(</font><font color="#330033">"btn_exit_cb"</font><font color="#993333">)</font><font color="#880033">)</font>

<font color="#330033">IupShowXY</font><font color="#880033">(</font><font color="#330033">dlg, IUP_CENTER, IUP_CENTER</font><font color="#880033">)</font>
<font color="#330033">IupMainLoop</font><font color="#880033">()</font>
<font color="#330033">IupClose</font><font color="#880033">()</font>
</pre>

<p> In the code, after the usual <em>include</em> and the call to <tt>IupOpen</tt>, we have added some new lines. These lines contain a regular function called <tt>btn_exit_cb</tt> that will be registered as our button callback. This function does nothing special: it just shows the "hello" message of the first example and closies the application, by returning code <em>IUP_CLOSE</em>.  </p>

<p> Note that we have added a new handle to make our vbox explicit, following the button declaration and before the dialog definition. It isn't necessary to do this, because the variable is never further referenced, but it does make the example code look cleaner!</p>

<p> There is then a new line, containing <tt>IupSetCallback</tt> which associates an action with an event-handling routine. The first argument is the widget, here the button, which initiates the event.The second argument is a global name for the event we wish to trap. Here we use the generalised term "ACTION". (The names of the available callback actions can be found at each control documentation). As with attribute names, actions are always written in upper-case. The final argument uses the function <tt>Icallback</tt> which links the event-handler's name directly with this event combination.</p>

<p> When executed, the application's dialog box will show up, and when the user presses the button, a hello message, alongside a button to close the application, are displayed. Although not profound, this small sample of code has covered the process of creating an IUP application, declaring elements and callbacks, and also handling an event. From now on, we are going to be introduced to more IUP controls and how to exploit these to improve our applications. </p>

<a name="_10_24addinglayoutelements"></a><a name="24addinglayoutelements"></a><h3>2.4 Adding Layout Elements</h3>
<p> Until now we have just positioned our controls inside a vbox which, as indicated above, aligns all controls inside it vertically. This is just a small sample of the IUP's layout concept. IUP implements an  <em>abstract layout</em>, "in which the positioning of controls is done relatively instead of  absolutely". These <strong>composition elements</strong> are necessary for composing the interface elements.  They are boxes and <em>fills</em> invisible to the user, but they play an important part. When a  dialog size changes, these containers expand or retract to adjust the positioning of the controls to the new situation allowing the dialog to adapt even if the resolution of the screen changes. That would come in handy if you port your application to another system with a lower resolution, for example. Main composition elements are vertical boxes (vbox), horizontal boxes (hbox)  and filling (fill), among others. There is also a depth box (zbox), in which layers of elements can  be created for the same dialog, and the elements in each layer are only visible when that given layer is active. </p>

<p> To clarify the way abstract layout works, lets modify our example adding a label to it.</p>

<pre class="examplecode"><font color="#FF0055">-- example2_4.exw</font>

<font color="#0000FF">include </font><font color="#330033">iup.ew</font>

<font color="#0000FF">function </font><font color="#330033">btn_exit_cb</font><font color="#880033">()</font>
<font color="#0000FF">    return </font><font color="#330033">IUP_CLOSE</font>
<font color="#0000FF">end function</font>

<font color="#330033">IupOpen</font><font color="#880033">()</font>

<font color="#FF0055">-- layout         </font>
<font color="#0000FF">atom </font><font color="#330033">lbl = IupLabel</font><font color="#880033">(</font><font color="#330033">"Hello world from IUP"</font><font color="#880033">)</font>
<font color="#0000FF">atom </font><font color="#330033">btn = IupButton</font><font color="#880033">(</font><font color="#330033">"OK"</font><font color="#880033">)</font>
<font color="#0000FF">atom </font><font color="#330033">vbox = IupVbox</font><font color="#880033">(</font><font color="#993333">{</font><font color="#330033">lbl, btn</font><font color="#993333">}</font><font color="#880033">)</font>
<font color="#0000FF">atom </font><font color="#330033">dlg = IupDialog</font><font color="#880033">(</font><font color="#330033">vbox</font><font color="#880033">)</font>

<font color="#FF0055">-- style</font>
<font color="#330033">IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"TITLE"</font><font color="#330033">, </font><font color="#330033">"Hello World 4"</font><font color="#880033">)</font>
<font color="#330033">IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"SIZE"</font><font color="#330033">, </font><font color="#330033">"QUARTERxQUARTER"</font><font color="#880033">)</font>

<font color="#FF0055">-- action            </font>
<font color="#330033">IupSetCallback</font><font color="#880033">(</font><font color="#330033">btn, </font><font color="#330033">"ACTION"</font><font color="#330033">, Icallback</font><font color="#993333">(</font><font color="#330033">"btn_exit_cb"</font><font color="#993333">)</font><font color="#880033">)</font>

<font color="#330033">IupShowXY</font><font color="#880033">(</font><font color="#330033">dlg, IUP_CENTER, IUP_CENTRE</font><font color="#880033">)</font>
<font color="#330033">IupMainLoop</font><font color="#880033">()</font>
<font color="#330033">IupClose</font><font color="#880033">()</font>
</pre>

<p> Note that there is a new label declaration and this new element  appears inside our vbox as the top element. That means it will be displayed above the button. Our example now has two different elements and is disposed vertically - one above the other. An interesting  exercise would be to change the code above and use an hbox to see what happens.</p>

<p> Note also that you can use the English spelling of <em>IUP_CENTER</em> if you prefer.</p>

<a name="_11_25improvingthelayout"></a><a name="25improvingthelayout"></a><h3>2.5 Improving the Layout</h3>
<p> Now that we have covered the basics of abstract layout, let us present three attributes available to both vboxes and hboxes. They are: <em>ALIGNMENT</em>; <em>GAP</em> and <em>MARGIN</em>.</p>

<p> <em>ALIGNMENT</em> defines the horizontal or vertical alignment of elements inside the box. If you are using a vbox, it will be an horizontal alignment, or if you are  using an hbox, it will be a vertical alignment. Its values can be <em>ALEFT</em>, <em>ACENTER</em> or <em>ARIGHT</em> for horizontal alignment, and <em>ATOP</em>, <em>ACENTER</em> ir ABOTTOM for vertical alignment. The default values are <em>ALEFT</em> and <em>ATOP</em>.</p>

<p> The <em>GAP</em> attribute defines a space, in pixels, between every element inside the box. If you are using a vbox, it will be a vertical space, or if you are using a hbox, it will be a horizontal space. The default value for <em>GAP</em> is <em>0</em> (zero), which means there is no space between elements.</p>

<p> The <em>MARGIN</em> attribute defines a margin, also measured in pixels. Its value has the format "widthxheight", in which width and height are integer values corresponding to the horizontal and vertical margins, respectively.  Its default value is <em>"0x0"</em> (no margin).</p>

<p> The additional elements in the next example show how our layout responds to these three attributes.</p>

<p> &lt;eucocde&gt;<del> example2_5.exw</p>

<p> include iup.ew</p>

<p> function btn_exit_cb()     return IUP_CLOSE end function</p>

<p> IupOpen()</p>
</del> layout atom lbl = IupLabel("Hello world from IUP") atom btn = IupButton("OK") atom vbox = IupVbox({lbl, btn}) atom dlg = IupDialog(vbox)</p>

<p> <del> attributes IupSetAttribute(vbox, "ALIGNMENT", "ACENTER") IupSetAttribute(vbox, "GAP", "10") IupSetAttribute(vbox, "MARGIN", "10x10")</p>
</del> actions IupSetCallback(btn, "ACTION", Icallback("btn_exit_cb"))</p>

<p> <del> execute IupShowXY(dlg, IUP_CENTER, IUP_CENTER) IupMainLoop() IupClose()&lt;/eucode&gt;</p>

<p> After creating the vbox, we have added three lines that set its attributes to values which differ from the default values. The resulting layout is much pleasanter. Note that it is still not quite like the first example, which uses a pre-defined dialog. Can you work out which attributes we need to set in order to obtain a closer match?</p>

<p> == 3. A Simple Notepad Application</p>

<p> Until now we have used two different controls: labels and buttons. Labels show text or images but are not designed for interaction. Buttons allow the user to trigger an event by pressing a mouse button. But none allow the user to insert any data into our application. To do that, we will use a new control, called <tt>IupText</tt>. It creates an editable text field and has a lot of different attributes available. We will mainly be interested in one for now: <em>MULTILINE</em>. <em>MULTILINE</em> turns the <tt>IupText</tt> into an editable text field that supports many lines, which is necessary in order to build a simple notepad.</p>

<p> === 3.1 Main Dialog</p>

<p> Our starting code for this simple notepad is as follows.</p>

<pre class="examplecode"></pre>
</del> example3_1.ex include iup.ew</p>

<p> IupOpen()     <del> layout</del></p>

<p>     atom multitxt = IupText()     atom vbox = IupVbox({ multitxt })     atom dlg = IupDialog(vbox)</p>

<p>     <del> attributes     IupSetAttribute(multitxt, "MULTILINE", "YES")     IupSetAttribute(multitxt, "EXPAND", "YES")     IupSetAttribute(dlg, "TITLE", "Simple Notepad")     IupSetAttribute(dlg, "SIZE", "QUARTERxQUARTER")     IupSetAttribute(dlg, "USERSIZE", NULL)</p>
</del> launch     IupShowXY(dlg, IUP_CENTER, IUP_CENTER)     IupMainLoop() IupClose()&lt;/eucode&gt;</p>

<p> This code doesn't do a lot, except for the <tt>IupText</tt> declaration and the call to <tt>IupSetAttribute</tt> to define the <tt>IupText</tt> as a <em>MULTILINE</em>. As the default value for this attribute is "NO", we need to set it to "YES" explicitly. Try to comment this line and see what happens. (You might also want to keep entering line-feeds to notice the effect.) </p>

<p> Notice also that the <em>SIZE</em> attribute of the dialog is set. Since the <tt>IupText</tt> is a control that does not fit its size to its contents, we have to set an initial size for the dialog, or else the result would be a very small dialog.  We use a simple size specification that is a quarter of the screen size in both dimensions. The <em>SIZE</em> attribute will also work as a minimum size, so we reset the <em>USERSIZE</em> attribute, after the dialog is shown, to avoid this limitation. Try to comment out this line and check how the dialog interactive resizing behaves.</p>

<p> With these few lines of code, we have build an application where the user can type a large amount of text. But, if you do type a lot of text, you would probably like to save it; unfortunately our application currently offers no such feature. We will handle this in the coming sections.</p>

<a name="_12_32addingamenu"></a><a name="32addingamenu"></a><h3>3.2 Adding a Menu</h3>
<p> Almost all applications offer a menu. Menus tend to be used to allow the user to load files, save files, use the clipboard, etc. IUP also offers this resource to the applications. Menus come in four different interface elements: <tt>IupItem</tt>;  <tt>IupMenu</tt>; <tt>IupSeparator</tt>; <tt>IupSubmenu</tt>.</p>

<p> <tt>IupItem</tt> creates a single item of the menu interface element. When selected, it generates an action.</p>

<p> <tt>IupSeparator</tt> creates a horizontal line that will appear between two menu items. It is normally used to divide and arrange different groups of menu items.</p>

<p> <tt>IupSubmenu</tt> creates an item that, when selected, opens another menu.</p>

<p> <tt>IupMenu</tt> creates the menu element by itself as a list of elements. An <tt>IupMenu</tt> can include any number of the other 3 types of menu interface elements: <tt>IupItem; </tt>IupSubmenu<tt>; </tt>IupSeparator<tt>. Any attemp to add another type of interface element into a menu will cause an error.</p>

<p> Let's add a menu with a few items to our example.</p>

<pre class="examplecode"><font color="#FF0055">-- example3_2.exw</font>
<font color="#0000FF">include </font><font color="#330033">iup.ew</font>

<font color="#0000FF">function </font><font color="#330033">exit_cb</font><font color="#880033">() </font><font color="#FF0055">-- event-handler (added in 3.2)</font>
<font color="#0000FF">    return </font><font color="#330033">IUP_CLOSE</font>
<font color="#0000FF">end function</font>

<font color="#330033">IupOpen</font><font color="#880033">()</font>

<font color="#FF0055">-- layout</font>
<font color="#FF0055">    -- menu (added in 3.2)</font>
<font color="#0000FF">    atom </font><font color="#330033">item_open = IupItem</font><font color="#880033">(</font><font color="#330033">"Open"</font><font color="#880033">) </font>
<font color="#0000FF">    atom </font><font color="#330033">item_saveas = IupItem</font><font color="#880033">(</font><font color="#330033">"Save As"</font><font color="#880033">)</font>
<font color="#0000FF">    atom </font><font color="#330033">item_exit = IupItem</font><font color="#880033">(</font><font color="#330033">"Exit"</font><font color="#880033">)</font>
<font color="#0000FF">    atom </font><font color="#330033">file_menu = IupMenu</font><font color="#880033">(</font><font color="#993333">{</font><font color="#330033">item_open, item_saveas, IupSeparator</font><font color="#0000FF">()</font><font color="#330033">, item_exit</font><font color="#993333">}</font><font color="#880033">)</font>
<font color="#0000FF">    atom </font><font color="#330033">sub1_menu = IupSubmenu</font><font color="#880033">(</font><font color="#330033">"File"</font><font color="#330033">, file_menu</font><font color="#880033">)</font>
<font color="#0000FF">    atom </font><font color="#330033">menu = IupMenu</font><font color="#880033">(</font><font color="#993333">{</font><font color="#330033">sub1_menu</font><font color="#993333">}</font><font color="#880033">)</font>
<font color="#FF0055">    -- dialog                        </font>
<font color="#0000FF">    atom </font><font color="#330033">multitext = IupText</font><font color="#880033">()</font>
<font color="#0000FF">    atom </font><font color="#330033">vbox = IupVbox</font><font color="#880033">(</font><font color="#993333">{</font><font color="#330033">multitext</font><font color="#993333">}</font><font color="#880033">)</font>
<font color="#0000FF">    atom </font><font color="#330033">dlg = IupDialog</font><font color="#880033">(</font><font color="#330033">vbox</font><font color="#880033">)</font>

<font color="#FF0055">    -- attributes                 </font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">multitext, </font><font color="#330033">"MULTILINE"</font><font color="#330033">, </font><font color="#330033">"YES"</font><font color="#880033">)</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">multitext, </font><font color="#330033">"EXPAND"</font><font color="#330033">, </font><font color="#330033">"YES"</font><font color="#880033">)</font>
<font color="#330033">    IupSetAttributeHandle</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"MENU"</font><font color="#330033">, menu</font><font color="#880033">) </font><font color="#FF0055">-- (added in 3.2)</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"TITLE"</font><font color="#330033">, </font><font color="#330033">"Simple Notepad"</font><font color="#880033">)</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"SIZE"</font><font color="#330033">, </font><font color="#330033">"QUARTERxQUARTER"</font><font color="#880033">)</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"USERSIZE"</font><font color="#330033">, NULL</font><font color="#880033">)</font>

<font color="#FF0055">    -- actions (added in 3.2)</font>
<font color="#330033">    IupSetCallback</font><font color="#880033">(</font><font color="#330033">item_exit, </font><font color="#330033">"ACTION"</font><font color="#330033">, Icallback</font><font color="#993333">(</font><font color="#330033">"exit_cb"</font><font color="#993333">)</font><font color="#880033">) </font><font color="#FF0055">-- event-handler (added in 3.2)</font>

<font color="#FF0055">    -- launch</font>
<font color="#330033">    IupShowXY</font><font color="#880033">(</font><font color="#330033">dlg, IUP_CENTER, IUP_CENTER</font><font color="#880033">)</font>
<font color="#330033">    IupMainLoop</font><font color="#880033">()</font>
<font color="#330033">IupClose</font><font color="#880033">()</font>
</pre>

<p> Now our example has a few menu element handlers and declarations. Also, we re-introduced our exit-callback for when the <em>item_exit</em> menu item is selected. The next line shows the composition of an </tt>IupMenu<tt> called <em>file_menu</em>. Note that the menu items are passed in order of appearance, which means that <em>item_open</em> will appear above <em>item_save</em> and so on. There is also an </tt>IupSeparator<tt> dividing our file menu into two parts: the first takes items that deal direct with files, like open and save, and the second takes the exit item. It's not mandatory to have an </tt>IupSeparator<tt> in your menu. This is used just to keep things more organized. The next line is a little tricky. We created a submenu to store all of our items. Why not use <em>file_menu</em> directly? We could, but it would be used as the main menu and would end up being the only menu available in our application. It's a good practice to separate menus in submenus and then pass these submenus as items of the main menu. By doing so, an application could have a file menu, a search menu, a help menu, etc., as items of the main menu, as you can see in the main menu declaration on the follwing line.</p>

<p> Once we are done building the main menu, we must set the <em>MENU</em> attribute of the main dialog to the menu we have just created. But since it is neither a string nor a number, we must use a different function to do this association, namely </tt>IupSetAttributeHandle<tt>.</p>

<p> Notice that the <em>Exit</em> menu item works fine, as we set the <em>Exit</em> menu item action callback, but <em>Open</em> and <em>Save</em> still don't work. That's because we didn't set any callback action for them. Those callbacks will use another IUP feature, which is the subject of our next section.</tt></p>

<a name="_13_33usingpredefineddialogs"></a><a name="33usingpredefineddialogs"></a><h3>3.3 Using Pre-defined Dialogs</h3>
<p> In the previous section, we added file-open and a file-save menu items, but they had no callbacks associated. That's because we will use new IUP resources to deal with file handling. These resources are called Pre-defined Dialogs.</p>

<p> Some dialogs (like file selection dialogs, font selection dialogs, color selection dialogs) are commonly found in a lot of different applications.  It would be annoying to have to build the same dialog again every time we need to select a file, a color or a font. So, IUP provides <strong>pre-defined dialogs</strong> with all the necessary controls to deal with these common tasks.</p>

<p> We update our last example to handle file input/output and to make use of these IUP pre-defined dialogs.</p>

<pre class="examplecode"><font color="#FF0055">-- example3_3.exw</font>
<font color="#0000FF">include </font><font color="#330033">iup.ew</font>
<font color="#0000FF">include </font><font color="#330033">std/io.e </font><font color="#FF0055">-- for read_file, write_file</font>

<font color="#330033">IupOpen</font><font color="#880033">()</font>

<font color="#0000FF">    atom </font><font color="#330033">multitext = IupText</font><font color="#880033">()</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">multitext, </font><font color="#330033">"MULTILINE"</font><font color="#330033">, </font><font color="#330033">"YES"</font><font color="#880033">)</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">multitext, </font><font color="#330033">"EXPAND"</font><font color="#330033">, </font><font color="#330033">"YES"</font><font color="#880033">)</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">multitext, </font><font color="#330033">"FONT"</font><font color="#330033">, </font><font color="#330033">"Arial, 12"</font><font color="#880033">)</font>

<font color="#0000FF">    atom</font>
<font color="#330033">    item_open = IupItem</font><font color="#880033">(</font><font color="#330033">"Open..."</font><font color="#880033">)</font><font color="#330033">,</font>
<font color="#330033">    item_saveas = IupItem</font><font color="#880033">(</font><font color="#330033">"Save As..."</font><font color="#880033">)</font><font color="#330033">,</font>
<font color="#330033">    item_exit = IupItem</font><font color="#880033">(</font><font color="#330033">"Exit"</font><font color="#880033">)</font><font color="#330033">,</font>
<font color="#330033">    item_font = IupItem</font><font color="#880033">(</font><font color="#330033">"Font..."</font><font color="#880033">)</font><font color="#330033">,</font>
<font color="#330033">    item_about = IupItem</font><font color="#880033">(</font><font color="#330033">"About..."</font><font color="#880033">)</font>

<font color="#330033">    IupSetCallback</font><font color="#880033">(</font><font color="#330033">item_exit, </font><font color="#330033">"ACTION"</font><font color="#330033">, Icallback</font><font color="#993333">(</font><font color="#330033">"exit_cb"</font><font color="#993333">)</font><font color="#880033">)</font>
<font color="#330033">    IupSetCallback</font><font color="#880033">(</font><font color="#330033">item_open, </font><font color="#330033">"ACTION"</font><font color="#330033">, Icallback</font><font color="#993333">(</font><font color="#330033">"open_cb"</font><font color="#993333">)</font><font color="#880033">)</font>
<font color="#330033">    IupSetCallback</font><font color="#880033">(</font><font color="#330033">item_saveas, </font><font color="#330033">"ACTION"</font><font color="#330033">, Icallback</font><font color="#993333">(</font><font color="#330033">"saveas_cb"</font><font color="#993333">)</font><font color="#880033">)</font>
<font color="#330033">    IupSetCallback</font><font color="#880033">(</font><font color="#330033">item_font, </font><font color="#330033">"ACTION"</font><font color="#330033">, Icallback</font><font color="#993333">(</font><font color="#330033">"font_cb"</font><font color="#993333">)</font><font color="#880033">)</font>
<font color="#330033">    IupSetCallback</font><font color="#880033">(</font><font color="#330033">item_about, </font><font color="#330033">"ACTION"</font><font color="#330033">, Icallback</font><font color="#993333">(</font><font color="#330033">"about_cb"</font><font color="#993333">)</font><font color="#880033">)</font>

<font color="#0000FF">    function </font><font color="#330033">readfile</font><font color="#880033">(</font><font color="#0000FF">sequence </font><font color="#330033">filename</font><font color="#880033">)</font>
<font color="#0000FF">        object </font><font color="#330033">str = read_file</font><font color="#880033">(</font><font color="#330033">filename</font><font color="#880033">)</font>
<font color="#0000FF">        if atom</font><font color="#880033">(</font><font color="#330033">str</font><font color="#880033">) </font><font color="#0000FF">then</font>
<font color="#330033">            IupMessage</font><font color="#880033">(</font><font color="#330033">"Error"</font><font color="#330033">, </font><font color="#0000FF">sprintf</font><font color="#993333">(</font><font color="#330033">"Cannot open file: %s"</font><font color="#330033">, </font><font color="#0000FF">{</font><font color="#330033">filename</font><font color="#0000FF">}</font><font color="#993333">)</font><font color="#880033">)</font>
<font color="#0000FF">            return </font><font color="#330033">0</font>
<font color="#0000FF">        else</font>
<font color="#0000FF">            return </font><font color="#330033">str  </font>
<font color="#0000FF">        end if</font>
<font color="#0000FF">    end function</font>

<font color="#0000FF">    atom </font><font color="#330033">file_menu = IupMenu</font><font color="#880033">(</font><font color="#993333">{</font>
<font color="#330033">                item_open,</font>
<font color="#330033">                item_saveas,</font>
<font color="#330033">                IupSeparator</font><font color="#0000FF">()</font><font color="#330033">,</font>
<font color="#330033">                item_exit</font>
<font color="#993333">        }</font><font color="#880033">)</font>

<font color="#0000FF">    atom </font><font color="#330033">format_menu = IupMenu</font><font color="#880033">(</font><font color="#993333">{</font>
<font color="#330033">                item_font</font>
<font color="#993333">        }</font><font color="#880033">)</font>

<font color="#0000FF">    atom </font><font color="#330033">help_menu = IupMenu</font><font color="#880033">(</font><font color="#993333">{</font>
<font color="#330033">                item_about</font>
<font color="#993333">        }</font><font color="#880033">)</font>

<font color="#0000FF">    atom </font><font color="#330033">sub_menu_file = IupSubmenu</font><font color="#880033">(</font><font color="#330033">"File"</font><font color="#330033">, file_menu</font><font color="#880033">)</font>
<font color="#0000FF">    atom </font><font color="#330033">sub_menu_format = IupSubmenu</font><font color="#880033">(</font><font color="#330033">"Format"</font><font color="#330033">, format_menu</font><font color="#880033">)</font>
<font color="#0000FF">    atom </font><font color="#330033">sub_menu_help = IupSubmenu</font><font color="#880033">(</font><font color="#330033">"Help"</font><font color="#330033">, help_menu</font><font color="#880033">)</font>

<font color="#0000FF">    atom </font><font color="#330033">menu = IupMenu</font><font color="#880033">(</font><font color="#993333">{</font>
<font color="#330033">        sub_menu_file, </font>
<font color="#330033">        sub_menu_format, </font>
<font color="#330033">        sub_menu_help</font>
<font color="#993333">        }</font><font color="#880033">)</font>

<font color="#0000FF">    atom </font><font color="#330033">vbox = IupVbox</font><font color="#880033">(</font><font color="#993333">{</font>
<font color="#330033">        multitext</font>
<font color="#993333">        }</font><font color="#880033">)</font>

<font color="#0000FF">    atom </font><font color="#330033">dlg = IupDialog</font><font color="#880033">(</font><font color="#330033">vbox</font><font color="#880033">)</font>
<font color="#330033">        IupSetAttributeHandle</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"MENU"</font><font color="#330033">, menu</font><font color="#880033">)</font>
<font color="#330033">        IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"TITLE"</font><font color="#330033">, </font><font color="#330033">"Simple Notepad"</font><font color="#880033">)</font>
<font color="#330033">        IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"SIZE"</font><font color="#330033">, </font><font color="#330033">"HALFxHALF"</font><font color="#880033">)</font>

<font color="#330033">        IupShowXY</font><font color="#880033">(</font><font color="#330033">dlg, IUP_CENTER, IUP_CENTER</font><font color="#880033">)</font>
<font color="#330033">        IupSetAttribute</font><font color="#880033">(</font><font color="#330033">dlg, </font><font color="#330033">"USERSIZE"</font><font color="#330033">, NULL</font><font color="#880033">)</font>

<font color="#330033">    IupMainLoop</font><font color="#880033">()</font>
<font color="#330033">IupClose</font><font color="#880033">()</font>

<font color="#0000FF">function </font><font color="#330033">writefile</font><font color="#880033">(</font><font color="#0000FF">sequence </font><font color="#330033">filename, </font><font color="#0000FF">sequence </font><font color="#330033">lines</font><font color="#880033">)</font>
<font color="#0000FF">    atom </font><font color="#330033">fn = </font><font color="#0000FF">open</font><font color="#880033">(</font><font color="#330033">filename, </font><font color="#330033">"w"</font><font color="#880033">)</font>
<font color="#0000FF">    if </font><font color="#330033">fn = 0 </font><font color="#0000FF">then</font>
<font color="#330033">        IupMessage</font><font color="#880033">(</font><font color="#330033">"Error"</font><font color="#330033">, </font><font color="#0000FF">sprintf</font><font color="#993333">(</font><font color="#330033">"Cannot open file: %s"</font><font color="#330033">, </font><font color="#0000FF">{</font><font color="#330033">filename</font><font color="#0000FF">}</font><font color="#993333">)</font><font color="#880033">)</font>
<font color="#0000FF">        return </font><font color="#330033">0</font>
<font color="#0000FF">    else</font>
<font color="#330033">        write_file</font><font color="#880033">(</font><font color="#330033">filename, lines</font><font color="#880033">)</font>
<font color="#0000FF">        return </font><font color="#330033">1</font>
<font color="#0000FF">    end if</font>
<font color="#0000FF">end function</font>

<font color="#0000FF">function </font><font color="#330033">open_cb</font><font color="#880033">()</font>
<font color="#0000FF">    atom </font><font color="#330033">filedlg = IupFileDlg</font><font color="#880033">()</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">filedlg, </font><font color="#330033">"DIALOGTYPE"</font><font color="#330033">, </font><font color="#330033">"OPEN"</font><font color="#880033">)</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">filedlg, </font><font color="#330033">"EXTFILTER"</font><font color="#330033">, </font><font color="#330033">"Text Files|*.txt||All Files|*.*|"</font><font color="#880033">)</font>

<font color="#330033">    IupPopup</font><font color="#880033">(</font><font color="#330033">filedlg, IUP_CENTER, IUP_CENTER</font><font color="#880033">)</font>

<font color="#0000FF">    if not </font><font color="#330033">IupGetInt</font><font color="#880033">(</font><font color="#330033">filedlg, </font><font color="#330033">"STATUS"</font><font color="#880033">) </font><font color="#330033">= 1 </font><font color="#0000FF">then</font>
<font color="#0000FF">        sequence </font><font color="#330033">filename = IupGetAttribute</font><font color="#880033">(</font><font color="#330033">filedlg, </font><font color="#330033">"VALUE"</font><font color="#880033">)</font>
<font color="#0000FF">        object </font><font color="#330033">str = readfile</font><font color="#880033">(</font><font color="#330033">filename</font><font color="#880033">)</font>
<font color="#0000FF">        if sequence</font><font color="#880033">(</font><font color="#330033">str</font><font color="#880033">) </font><font color="#0000FF">then</font>
<font color="#330033">            IupSetAttribute</font><font color="#880033">(</font><font color="#330033">multitext, </font><font color="#330033">"VALUE"</font><font color="#330033">, str</font><font color="#880033">)</font>
<font color="#0000FF">        end if</font>
<font color="#0000FF">    end if</font>
<font color="#330033">    IupDestroy</font><font color="#880033">(</font><font color="#330033">filedlg</font><font color="#880033">)</font>
<font color="#0000FF">    return </font><font color="#330033">IUP_DEFAULT</font>
<font color="#0000FF">end function</font>

<font color="#0000FF">function </font><font color="#330033">saveas_cb</font><font color="#880033">()</font>
<font color="#0000FF">    atom </font><font color="#330033">filedlg = IupFileDlg</font><font color="#880033">()</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">filedlg, </font><font color="#330033">"DIALOGTYPE"</font><font color="#330033">, </font><font color="#330033">"SAVE"</font><font color="#880033">)</font>
<font color="#330033">    IupSetAttribute</font><font color="#880033">(</font><font color="#330033">filedlg, </font><font color="#330033">"EXTFILTER"</font><font color="#330033">, </font><font color="#330033">"Text Files|*.txt|All Files|*.*|"</font><font color="#880033">)</font>

<font color="#330033">    IupPopup</font><font color="#880033">(</font><font color="#330033">filedlg, IUP_CENTER, IUP_CENTER</font><font color="#880033">)</font>

<font color="#0000FF">    sequence </font><font color="#330033">filename = IupGetAttribute</font><font color="#880033">(</font><font color="#330033">filedlg, </font><font color="#330033">"VALUE"</font><font color="#880033">)</font>
<font color="#0000FF">    sequence </font><font color="#330033">str = IupGetAttribute</font><font color="#880033">(</font><font color="#330033">multitext, </font><font color="#330033">"VALUE"</font><font color="#880033">)</font>
<font color="#0000FF">    integer </font><font color="#330033">count = IupGetInt</font><font color="#880033">(</font><font color="#330033">multitext, </font><font color="#330033">"COUNT"</font><font color="#880033">)</font>
<font color="#330033">    writefile</font><font color="#880033">(</font><font color="#330033">filename, str</font><font color="#880033">)</font>

<font color="#330033">    IupDestroy</font><font color="#880033">(</font><font color="#330033">filedlg</font><font color="#880033">)</font>
<font color="#0000FF">    return </font><font color="#330033">IUP_DEFAULT</font>
<font color="#0000FF">end function</font>

<font color="#0000FF">function </font><font color="#330033">font_cb</font><font color="#880033">()</font>
<font color="#0000FF">    atom </font><font color="#330033">fontdlg = IupFontDlg</font><font color="#880033">()</font>
<font color="#0000FF">    sequence </font><font color="#330033">font = IupGetAttribute</font><font color="#880033">(</font><font color="#330033">multitext, </font><font color="#330033">"FONT"</font><font color="#880033">)</font>
<font color="#330033">    IupSetStrAttribute</font><font color="#880033">(</font><font color="#330033">fontdlg, </font><font color="#330033">"VALUE"</font><font color="#330033">, font</font><font color="#880033">)</font>
<font color="#330033">    IupPopup</font><font color="#880033">(</font><font color="#330033">fontdlg, IUP_CENTER, IUP_CENTER</font><font color="#880033">)</font>

<font color="#0000FF">    if </font><font color="#330033">IupGetInt</font><font color="#880033">(</font><font color="#330033">fontdlg, </font><font color="#330033">"STATUS"</font><font color="#880033">) </font><font color="#330033">= 1 </font><font color="#0000FF">then</font>
<font color="#330033">        font = IupGetAttribute</font><font color="#880033">(</font><font color="#330033">fontdlg, </font><font color="#330033">"VALUE"</font><font color="#880033">)</font>
<font color="#330033">        IupSetStrAttribute</font><font color="#880033">(</font><font color="#330033">multitext, </font><font color="#330033">"FONT"</font><font color="#330033">, font</font><font color="#880033">)</font>
<font color="#0000FF">    end if</font>

<font color="#330033">    IupDestroy</font><font color="#880033">(</font><font color="#330033">fontdlg</font><font color="#880033">)</font>
<font color="#0000FF">    return </font><font color="#330033">IUP_DEFAULT</font>
<font color="#0000FF">end function</font>

<font color="#0000FF">function </font><font color="#330033">about_cb</font><font color="#880033">() </font>
<font color="#330033">    IupMessage</font><font color="#880033">(</font><font color="#330033">"About"</font><font color="#330033">, </font><font color="#330033">"Simple Notepad"</font><font color="#880033">)</font>
<font color="#0000FF">    return </font><font color="#330033">IUP_DEFAULT</font>
<font color="#0000FF">end function</font>

<font color="#0000FF">function </font><font color="#330033">exit_cb</font><font color="#880033">()</font>
<font color="#0000FF">    return </font><font color="#330033">IUP_CLOSE</font>
<font color="#0000FF">end function</font>
</pre>

<p> Note that we need to access the multitext control from inside the menu callbacks. There are several ways to do that; the simplest one is to declare it outside the event-handlers, so it is "visible" throughout the application's code. In the next example, a different approach is taken.</p>

<p> Let's take a look at the new callback called <tt>open_cb</tt>. This callback will handle the file opening when the user clicks on the <em>Open</em> menu item. For this we will use a IUP predefined dialog called <tt>IupFileDlg</tt>. This dialog is a standard file-handling dialog with all the features that we need to select a file from the file system; it also saves a  lot of work. Inside the callback we refine our <tt>IupFileDlg</tt>, and set it to be an  "<em>open</em>" dialog with attribute <em>DIALOGTYPE</em>. Also we set <em>EXTFILTER </em>attribute to  <em>"Text Files|*.txt|All Files|*.*|"</em>, since we want our application to handle text files but we leave the option for listing and selecting other files. Note also that the application cannot "open" a non-existent file, using the <em>STATUS</em> attribute.</p>

<p> Now the program calls <tt>IupPopup</tt>, which is a function similar to <tt>IupShow</tt>, but it restricts the user interaction only within the specified dialog. It is the equivalent of creating a Modal dialog in some toolkits. Its arguments are our file dialog handle followed by the <em>x</em> and <em>y</em> coordinates that we defined as the centre of the screen with <em>IUP_CENTER</em>.</p>

<p> Then we have a conditional test in which we get the value of <em>filedlg</em> STATUS with <tt>IupGetInt</tt>.  Why not use <tt>IupGetAttribute</tt>  instead? That's because <tt>IupGetAttribute</tt> returns string attributes, but we know that <em>STATUS</em> is an integer so we use the appropriate function <tt>IupGetInt</tt>.</p>

<p> Once our file dialog returns a valid status, we are able to recover the name of the selected file using <tt>IupGetAttribute</tt> to retrieve the <em>VALUE</em> attribute. Then we read the file using a standard function and fill in its contents on the multitext control by using the <tt>IupSetStrAttribute</tt> function to set its <em>VALUE</em> attribute. We could have used the <tt>IupSetAttribute</tt> function here, but follow the C-language practice because C strings returned by <tt>IupGetAttribute</tt> use a pointer.</p>

<p> Now we don't need this dialog any more, so you can simply call <tt>IupDestroy</tt> to remove <em>filedlg</em> from memory.</p>

<p> Next there is another callback, <tt>saveas_cb</tt>, which allows for the selection of a file name for saving the content of a file. It is very similar to <tt>open_cb</tt>, but <em>DIALOGTYPE</em> is set to <em>SAVE</em>, so this time it consider a file name for saving. In this case the filename can refer to a new file, but if an existing file is chosen then the user will be notified of overwriting so it can cancel and try again. After selecting the filename the multitext contents are copied to the file using another standard routine. (Note that the double option is only possibly by disregarding the <em>STATUS</em> value.)</p>

<p> Now comes the <tt>font_cb</tt> callback that, as you may have already guessed, will call a predefined dialog to select a font. To do that, we use <tt>IupFontDlg</tt>, as a parallel of <tt>IupFileDlg</tt>. You can set or change the font by changing the FONT attribute in the multitext control; this is precisely what this event-handler does. (Note that the multitext widget's font has been pre-set at the top of the code.)</p>

<p> The next callback is <tt>about_cb</tt>, which just calls <tt>IupMessage</tt> to display text to the user.</p>

<p> The additional lines add the new callback registrations. Also we added have added "..." to the text of the menu items. This is not mandatory, but is highly recommended by common User Interface Guidelines. Note also that the main dialog is now bigger - to make it of more general applicability.</p>

<p> So the result is a brand new text editor, crated and serviced using IUP. But what happens if the dialog you need is not provided by IUP as a predefined dialog? That will be the subject of our next section.</p>

<a name="_14_34customdialogs"></a><a name="34customdialogs"></a><h3>3.4 Custom Dialogs</h3>
<p> We saw in the previous section that IUP provides predefined dialogs that can be utilised in applications to save a lot of development time. But if the dialog your application needs is not one of IUP's predefined dialogs, then you have to build your own dialog. The good news is that you have already covered this when building the main dialog. The tricky part is how to handle more than one dialog at the same time.</p>

<p> For this we shall add two new items to a new <em>Edit</em> menu: <em>Find</em> and <em>Go To</em>. <em>Find</em> will search the multitext contents while looking for a string and highlight it when found. It will search for this string many times, and the search can also be case sensitive. The purpose of <em>Go To</em> is to (re-)position the caret to a specific line in the text.</p>

<p> These additions may seem relatively simple, but they involve quite a lot of steps, some quite detailed. These also involve several "new" ideas and raise a number of fundamental aspects of programming using IUP. So, the strategy here is to break down the new features into chunks, where each addition is outlined before the code blocks are introduced.</p>

<p> Before doing even that, however, a few observations might be in order. Generally speaking, most problems in IUP have more than one solution, so the approach described here is by no means the only one. Additionally, sometimes it is easier to address an issue using a feature of the "carrier" language, rather than through IUP itself. Bits of both approaches can sometimes be the best solution, if not the purest. For any solution you can probably think of another one!</p>

<p> It is probably true to say that IUP's capacity to solve problems is mainly delivered using the <em>attribute</em> concept. Each iteration of IUP adds more attribute properties to established controls. If you read the "Attributes" entry in IUP's documentation you can clearly discern a close mapping with OOP: inheritance and "property" values, along with accessor and mutator actions, through variants of "IupGetAttribute" and "IupSetAttribute". What is explicit is that setting an attribute usually has an "action" associated with it; what isn't explicit is that an IUP user can exploit these facilities to define her/his own attributes.</p>

<p> Now back to the "plot".</p>

<p> The code from Section 3.3 first needs the addition of the identifiers to add the menu and items, as follows:</p>

<pre class="examplecode"><font color="#330033">item_find = IupItem</font><font color="#880033">(</font><font color="#330033">"Find.."</font><font color="#880033">)</font><font color="#330033">,</font>
<font color="#330033">    item_goto = IupItem</font><font color="#880033">(</font><font color="#330033">"Go To..."</font><font color="#880033">)</font><font color="#330033">,</font>
<font color="#FF0055">    --</font>
<font color="#0000FF">    atom </font><font color="#330033">edit_menu = IupMenu</font><font color="#880033">(</font><font color="#993333">{</font>
<font color="#330033">                item_find,</font>
<font color="#330033">                item_goto</font>
<font color="#993333">        }</font><font color="#880033">)</font>
<font color="#FF0055">    --</font>
<font color="#0000FF">    atom </font><font color="#330033">sub_menu_edit = IupSubmenu</font><font color="#880033">(</font><font color="#330033">"Edit"</font><font color="#330033">, edit_menu</font><font color="#880033">)</font>
</pre>

<p> plus the menu-definitional change:</p>

<pre class="examplecode"><font color="#0000FF">atom </font><font color="#330033">menu = IupMenu</font><font color="#880033">(</font><font color="#993333">{</font>
<font color="#330033">        sub_menu_file,</font>
<font color="#330033">        sub_menu_edit, </font><font color="#FF0055">-- addition</font>
<font color="#330033">        sub_menu_format, </font>
<font color="#330033">        sub_menu_help</font>
<font color="#993333">        }</font><font color="#880033">)</font>
</pre>

<p> These additions can be found as <em>example3_4a.exw</em>. Each additional line has been annotated by comment and you can try it out by running this code.</p>

<a name="_15_341thefindoption"></a><a name="341thefindoption"></a><h4>3.4.1 The find option</h4>
<p> Let's now "design" the process we wish to add to effect a search facility.</p>

<p> On clicking the menu item we want to open a dedicated dialog to guide users through this process. We want this dialog to appear above our main dialog (this is known as a popup dialog), but not so as to cover it, and to contain within it several features:</p>
<ul><li>a text control to receive the user's search text
</li><li>a means of signifying if we want the search to be case-sensitive (we use a 'toggle' for this)
</li><li>a means of signifying that the search text and toggle are to be actioned
</li><li>a means of moving on to the next occurrence of the search text (we use a button for this)
</li><li>a button to indicate that we have completed our search
</li></ul>
<p>We then want to lay out all these elements in a nice-looking manner.</p>

<p> <tt>IupToggle</tt> is a two-state (on/off) button that, when selected, execute a callback. Toggles are normally used to set flags. In this case, we used it to allow the user to decide if the search will be case sensitive or not.</p>

<p> Note also the use of <tt>IupFill</tt>. If you put an <tt>IupFill</tt> inside an <tt>IupHbox</tt>, it will expand between the two elements, pushing one to the left and the other to the right. Or if you put it in an <tt>IupVbox</tt>, above a element, it will push the element all the way down. In our case, <tt>IupFill</tt> is being used to push the buttons to the right, inside our <tt>IupHbox</tt>.</p>

<p> Note that our new dialog has a lot of new parameters set. <em>DIALOGFRAME</em> will remove minbox, maxbox, and it will resize from the corner of the dialog. This will provide reduced functionality but still giving a standard dialog box appearance. <em>DEFAULTENTER</em> defines a button to be activated when the users presses ENTER, in this case it will have the same effect as pressing the <em>bt_next</em> button. DEFAULTESC works the same way for the ESC key by activating the <em>bt_close</em> button. If you use these facilities you may well see, in the GUI, a simulated button-press!</p>

<p> The bare bones of the relevant code are shown in <em>example3_4b.exw</em>. Again the newly-added code is annotated with comment.</p>

<p> To complete this step an event-handler callback routine has been added to respond to the <em>item_find</em> selection. As yet, all it does is check that the <em>find_dlg</em> dialog opens and looks OK.</p>

<p> A more elaborate naming convention has been adopted for this callback routine, as a marker that there are more events than "ACTION"!</p>

<p> Finally a further callback routine enables the "Find" dialog to be closed. Note that the dialog is hidden rather than destroyed, so it remains available for future calls and doesn't have to be re-created.</p>

<p> There is quite a lot to take in here, but do try to understand the approach. Obviously we need another callback for <em>bt_next</em>, which initiates the find/search process.</p>

<p> Here are some specific things to think about before proceding:</p>
<ul><li>the switch to using the <strong>Ihandle</strong> type to define these new IUP widgets
</li><li>restricting variable assignment to those controls that are referenced elsewhere
</li><li>how attribute values are used both to smarten the layout and to set default 'ENTER' and 'esc' actions
</li><li>placement of the 'popup' dialog and all its elements within the main body of the application rather than in a separate routine to ensure full visibility (not really ideal because the code is getting quite long!)
</li></ul>
<p>Before embarking on the next task a bit of a digression is needed. Euphoria has the built-in function <tt>match</tt> which returns the (starting) position of a search text in a source text. IUP, in its IupText element, has three concepts:</p>
<ul><li><em>lin</em>: the line where a piece of (sub)text starts
</li><li><em>col</em>: the column where a piece of (sub)text starts
</li><li><em>pos</em>: the absolute position within the running text
</li></ul>
<p>You might think that the return value of <tt>match</tt> and <em>pos</em> are the same thing, but, unfortunately they are not. This is because Euphoria has a 1-based system of in-text location; the C-language is 0-based. In the Euphoria wrapper, therefore, we have adopted the Euphoria convention, but please note that this doesn't match the IUP documentation!</p>

<p> Recall that not only do we wish our search facility to locate our "find" in the master text but also we wish to highlight it. That's why we need access to IUP's world, so that we can utilise IupText's attributes, including using the <em>lin</em> and <em>col</em> values.</p>

<p> The stored <em>example3_4c</em> shows a way of addressing these issues and thus completes the <em>Find</em> option.</p>

<p> The new steps are as follows.</p>

<p> We add a little function that packs <tt>match</tt> to be case sensitive. A callback routine is added for <em>bt_next</em> and this is where all the remaining 'search' action goes. Each line has been annotated in the code block to aid understanding.</p>

<p> To finish off this extension to the notepad, another button has been added to the find dialog, to enable the user to "reset" - start a [new] search from the start of the source! (You will notice just how many bits-and-pieces need to be re-initialised.)</p>

<p> Please try out this version to see how it delivers.</p>

<p> Note also that the 'about' menu item now attributes the authors of all this work!</p>

<a name="_16_342thegotooption"></a><a name="342thegotooption"></a><h4>3.4.2 The goto option</h4>
<p> Here we want to be able to move to a specific line of text and will move the caret there.</p>

<p> The complete code is here:</p>

<pre class="examplecode"><font color="#FF0055">-- example3_4.exw</font>
</pre>

<p> Another way of packaging this application is offered in <em>example3_4x.exw</em>, where more separation of code blocks has been effected.</p>

<p> If you have reached this point successfully, you might also consider looking at the IUP website and surveying this Tutorial there, and scrutinising the two solutions (C and Lua) presented.</p>

<p> These exploit a rather hidden feature of IUP. All the documentation about attributes implies that only those listed for a given control element have any meaning and the <em>NULL</em> return value is merely a trap for mistakes! In fact you can define your own and set and get values. You can even test for the existence of one that you haven't yet defined - like a boolean test to see if something needs to be done.</p>

<p> These solutions also embed the 'child' dialogs, including creation, inside callback functions. This entails quite a lot of getting and setting of layout hierarchy to create selective visibility of IUP elements in different code blocks. In Euphoria, use of scope rules seems a better route for us to take!</p>
</p></p>
</body></html>